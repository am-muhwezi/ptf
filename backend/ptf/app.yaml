name: ptf-app
region: bga

services:
  - name: frontend
    environment_slug: node-js
    source_dir: frontend
    github:
      repo: am-muhwezi/ptf
      branch: main
      deploy_on_push: true
    build_command: npm install && npm run build
    run_command: npm start
    routes:
      - path: /

  - name: backend
    environment_slug: python
    source_dir: backend
    github:
      repo: am-muhwezi/ptf
      branch: main
      deploy_on_push: true
    build_command: >
      pip install -r requirements.txt &&
      python manage.py migrate
    run_command: gunicorn ptf.wsgi:application --log-file -
    routes:
      - path: /api
    envs:
      - key: DEBUG
        value: "False"
      - key: DJANGO_SECRET_KEY
        value: your-production-secret-key-here
        type: SECRET
      - key: DJANGO_ALLOWED_HOSTS
        value: ${APP_DOMAIN}
      - key: DATABASE_URL
        value: ${ptf-db.DATABASE_URL}
      - key: CORS_ALLOWED_ORIGINS
        value: ${frontend.PUBLIC_URL}
      - key: DISABLE_COLLECTSTATIC
        value: "1"

databases:
  - engine: PG
    name: ptf-db
    num_nodes: 1
    size: db-s-dev-database
    version: "14"